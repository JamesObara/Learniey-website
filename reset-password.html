<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Learn how to verify your Learniey account email address and troubleshoot verification issues.">
  <title>Reset Password - Learniey</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="shortcut icon" href="./adaptive-icon.png" type="image/x-icon">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
        <a href="./" class="logo">
            <span>Learniey</span>
            <div class="logo-underline"></div>
        </a>
        <div class="menu-toggle" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="nav-links" id="navLinks">
            <li><a href="./">Home</a></li>
            <li><a href="./#features">Features</a></li>
            <li><a href="./help">Help & Support</a></li>
            <!-- <li><a href="./#download" class="btn-download">Download App</a></li> -->
        </ul>
        </div>
    </nav>

    <main style="flex: 1; display: flex; align-items: center; justify-content: center; padding: 2rem;">
        <div style=" border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); padding: 3rem 2rem; max-width: 500px; width: 100%;">
        
        <!-- Icon -->
        <div style="width: 95px; height: 95px; background:  #130457; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem;">
            <span style="font-size: 2rem;color: #ffffff;">
                <i class="fa fa-unlock-alt" aria-hidden="true"></i>
            </span>
        </div>

        <!-- Title -->
        <h1 style="font-size: 1.6rem; color: #1e293b; margin-bottom: 0.5rem; font-weight: 700; text-align: center;">
            Reset Your <span style="color: linear-gradient(135deg, #130457 0%, #3b1a8f 100%);">Password</span>
        </h1>

        <!-- Description -->
        <p style="color: #666; font-size: 1rem; margin-bottom: 2rem; text-align: center;">
            Enter your new password below. Make sure it's strong and secure.
        </p>

        <!-- Form -->
        <form id="resetForm" onsubmit="handleReset(event)">
            <!-- New Password Field -->
            <div style="margin-bottom: 1.5rem;">
            <label for="newPassword" style="display: block; color: #130457; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                New Password
            </label>
            <div style="position: relative;">
                <input 
                type="password" 
                id="newPassword" 
                name="newPassword" 
                placeholder="Enter new password"
                required
                minlength="8"
                style="width: 100%; padding: 1rem 3rem 1rem 1rem; border: 2px solid #d1d5db; border-radius: 12px; font-size: 1rem; transition: border-color 0.3s; box-sizing: border-box; outline: none;background: #e2e8f0;color: #130457;"
                onfocus="this.style.borderColor='#130457'"
                onblur="this.style.borderColor='#d1d5db'"
                >
                <button 
                type="button" 
                onclick="togglePassword('newPassword', this)"
                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #999; font-size: 1.2rem; padding: 0;"
                >
                <i class="fa fa-eye" aria-hidden="true"></i>
                </button>
            </div>
            </div>

            <!-- Confirm Password Field -->
            <div style="margin-bottom: 1.5rem;">
            <label for="confirmPassword" style="display: block; color: #130457; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">
                Confirm New Password
            </label>
            <div style="position: relative;">
                <input 
                type="password" 
                id="confirmPassword" 
                name="confirmPassword" 
                placeholder="Confirm new password"
                required
                minlength="8"
                style="width: 100%; padding: 1rem 3rem 1rem 1rem; border: 2px solid #d1d5db; border-radius: 12px; font-size: 1rem; transition: border-color 0.3s; box-sizing: border-box; outline: none;background: #e2e8f0;color: #130457;"
                onfocus="this.style.borderColor='#130457'"
                onblur="this.style.borderColor='#d1d5db'"
                >
                <button 
                type="button" 
                onclick="togglePassword('confirmPassword', this)"
                style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #999; font-size: 1.2rem; padding: 0;"
                >
                    <i class="fa fa-eye" aria-hidden="true"></i>
                </button>
            </div>
            </div>

            <!-- Password Requirements -->
            <div style="background-color: none; padding: 1rem; border-radius: 10px; margin-bottom: 1.5rem;">
            <p style="color: #130457; font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem;">Password must contain:</p>
            <ul style="color: #666; font-size: 0.85rem; margin: 0; padding-left: 1.2rem;">
                <li id="req-length" style="margin-bottom: 0.25rem;">At least 8 characters</li>
            </ul>
            </div>

            <!-- Status Message -->
            <div id="statusMessage" style="margin-bottom: 1.5rem; padding: 1rem; border-radius: 10px; display: none;color: #FF6B6B;"></div>

            <!-- Submit Button -->
            <button 
            type="submit" 
            id="submitBtn"
            style="display: block; width: 100%; background: #130457; color: #fff; padding: 1rem; border-radius: 50px; font-weight: 600; font-size: 1rem; border: none; cursor: pointer; box-shadow: 0 4px 20px rgba(61, 32, 11, 0.4); transition: transform 0.3s, box-shadow 0.3s;"
            >
            Reset Password
            </button>
        </form>

        

        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
        <div class="footer-content">
            <div class="footer-section">
            <h3>Learniey</h3>
            <p>A smart learning hub designed to help students stay organized, connected, and focused on their academic success.</p>
            </div>
            <div class="footer-section">
            <h3>Quick Links</h3>
            <ul class="footer-links">
                <li><a href="./">Home</a></li>
                <li><a href="./#features">Features</a></li>
                <li><a href="./help">Help & Support</a></li>
                <li><a href="./#download">Download App</a></li>
            </ul>
            </div>
            <div class="footer-section">
            <h3>Support</h3>
            <ul class="footer-links">
                <li><a href="./help">Help Center</a></li>
                <li><a href="./forgot-password">Forgot Password</a></li>
                <li><a href="./verify-email">Verify Email</a></li>
            </ul>
            </div>
            <div class="footer-section">
            <h3>Legal</h3>
            <ul class="footer-links">
                <li><a href="./terms">Terms & Conditions</a></li>
                <li><a href="./privacy">Privacy Policy</a></li>
            </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Learniey. All rights reserved.</p>
        </div>
        </div>
    </footer>

    <script>
        function toggleMenu() {
        const navLinks = document.getElementById('navLinks');
        navLinks.classList.toggle('active');
        }

        document.addEventListener('click', function(event) {
        const navLinks = document.getElementById('navLinks');
        const menuToggle = document.querySelector('.menu-toggle');
        const navbar = document.querySelector('.navbar');
        
        if (!navbar.contains(event.target)) {
            navLinks.classList.remove('active');
        }
        });

        document.querySelectorAll('.nav-links a').forEach(link => {
        link.addEventListener('click', function() {
            document.getElementById('navLinks').classList.remove('active');
        });
        });

        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector("i"); 

            if (input.type === "password") {
            input.type = "text";
            icon.classList.remove("fa-eye");      
            icon.classList.add("fa-eye-slash");
            } else {
            input.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
            }
        }

        document.getElementById("newPassword").addEventListener("input", function () {
            const password = this.value;
            document.getElementById("req-length").style.color =
            password.length >= 8 ? "#28a745" : "#666";
            document.getElementById("req-upper").style.color =
            /[A-Z]/.test(password) ? "#28a745" : "#666";
            document.getElementById("req-lower").style.color =
            /[a-z]/.test(password) ? "#28a745" : "#666";
            document.getElementById("req-number").style.color =
            /[0-9]/.test(password) ? "#28a745" : "#666";
        });

        async function handleReset(event) {
            event.preventDefault();

            const newPassword = document.getElementById("newPassword").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const statusMsg = document.getElementById("statusMessage");
            const submitBtn = document.getElementById("submitBtn");

            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get("token");

            if (!token) {
            return showError("Invalid or expired reset link.");
            }

            if (newPassword !== confirmPassword) {
            return showError("Passwords do not match.");
            }

            const isStrong =
            newPassword.length >= 8 
            
            if (!isStrong) {
            return showError("Password does not meet requirements.");
            }

            submitBtn.innerHTML = "Resetting...";
            submitBtn.style.opacity = "0.7";
            submitBtn.disabled = true;

            function showError(msg) {
            statusMsg.style.display = "block";
            statusMsg.style.backgroundColor = "#f8d7da";
            statusMsg.style.color = "#721c24";
            statusMsg.innerHTML = `<strong>Error:</strong> ${msg}`;
            }

            try {
            const response = await fetch(
                "http://localhost:4500/auth/reset-password",
                {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    token: token,
                    newPassword: newPassword
                }),
                }
            );

            const result = await response.json();

            if (!response.ok) {
                showError(result.message || "Reset failed.");
                submitBtn.innerHTML = "Reset Password";
                submitBtn.disabled = false;
                submitBtn.style.opacity = "1";
                return;
            }

            statusMsg.style.display = "block";
            statusMsg.style.backgroundColor = "#d4edda";
            statusMsg.style.color = "#155724";
            statusMsg.innerHTML =
                "<strong>✓ Password Reset Successfully!</strong><br>You can now log in.";

            submitBtn.innerHTML = "✓ Success";
            submitBtn.style.background = "#28a745";

            setTimeout(() => {
                window.location.href = "/"; 
            }, 2000);

            } catch (err) {
            showError("Something went wrong. Try again.");
            submitBtn.innerHTML = "Reset Password";
            submitBtn.disabled = false;
            submitBtn.style.opacity = "1";
            }
        }
    </script>
</body>
</html>